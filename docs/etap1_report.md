# üõ†Ô∏è –≠—Ç–∞–ø 1 ‚Äî –ü–æ—á–∏–Ω–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–§–∞–π–ª: `server/src/routes/auth.js`**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ CSRF –∑–∞—â–∏—Ç–∞ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ httpOnly cookies –¥–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (email, –ø–∞—Ä–æ–ª—å, –∏–º—è)
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –∫–æ–¥–∞–º–∏ –æ—à–∏–±–æ–∫
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω endpoint `/api/auth/csrf-token` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è CSRF —Ç–æ–∫–µ–Ω–∞
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π logout —Å –æ—á–∏—Å—Ç–∫–æ–π cookies

**–§–∞–π–ª: `server/src/index.js`**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω cookie-parser –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ cookies
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω CORS —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π credentials
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è FRONTEND_URL

**–§–∞–π–ª: `server/package.json`**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å cookie-parser@^1.4.6

### 2. –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–§–∞–π–ª: `apps/web/lib/api.ts`**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è CSRF —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ CSRF —Ç–æ–∫–µ–Ω–æ–≤ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ credentials: 'include' –¥–ª—è cookies
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ logout() —Å –æ—á–∏—Å—Ç–∫–æ–π —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–§–∞–π–ª: `apps/web/hooks/useAuth.tsx`**
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π cookies
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å localStorage –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π logout

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

**–§–∞–π–ª: `server/Dockerfile`**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (npm install –≤–º–µ—Å—Ç–æ npm ci)

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Cookies –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```javascript
// httpOnly cookie –¥–ª—è JWT —Ç–æ–∫–µ–Ω–∞
res.cookie('auth_token', token, {
  httpOnly: true,
  secure: process.env.NODE_ENV === 'production',
  sameSite: 'lax',
  maxAge: 24 * 60 * 60 * 1000, // 24 —á–∞—Å–∞
  path: '/'
});

// CSRF —Ç–æ–∫–µ–Ω (–Ω–µ httpOnly –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ JS)
res.cookie('csrf_token', csrfToken, {
  httpOnly: false,
  secure: process.env.NODE_ENV === 'production',
  sameSite: 'lax',
  maxAge: 24 * 60 * 60 * 1000
});
```

### CSRF –∑–∞—â–∏—Ç–∞
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞: `GET /api/auth/csrf-token`
- –í–∞–ª–∏–¥–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `X-CSRF-Token` –∏–ª–∏ –ø–æ–ª—è `csrfToken` –≤ body
- –¢–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ cookies –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- Email: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Å regex
- –ü–∞—Ä–æ–ª—å: –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤
- –ò–º—è: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
- –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å email –≤ –ë–î

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –õ–æ–≥–∏–Ω
```bash
curl -X POST http://localhost:3001/api/auth/login \
  -H "Content-Type: application/json" \
  -H "X-CSRF-Token: [token]" \
  -d '{"email":"admin@eda.com","password":"admin123"}'

# –†–µ–∑—É–ª—å—Ç–∞—Ç: {"success":true,"message":"–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥",...}
```

### ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
```bash
curl -X POST http://localhost:3001/api/auth/register \
  -H "Content-Type: application/json" \
  -H "X-CSRF-Token: [token]" \
  -d '{"email":"new@example.com","password":"test123","name":"–ù–æ–≤—ã–π"}'

# –†–µ–∑—É–ª—å—Ç–∞—Ç: {"success":true,"message":"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω",...}
```

### ‚úÖ –í—ã—Ö–æ–¥
```bash
curl -X POST http://localhost:3001/api/auth/logout \
  -H "X-CSRF-Token: [token]"

# –†–µ–∑—É–ª—å—Ç–∞—Ç: {"success":true,"message":"–£—Å–ø–µ—à–Ω—ã–π –≤—ã—Ö–æ–¥"}
```

### ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: `{"code":"INVALID_CREDENTIALS"}`
- –°–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å: `{"code":"WEAK_PASSWORD"}`
- –ù–µ–≤–µ—Ä–Ω—ã–π email: `{"code":"INVALID_EMAIL"}`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: `{"code":"USER_EXISTS"}`
- CSRF –æ—à–∏–±–∫–∞: `{"message":"CSRF —Ç–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω"}`

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–≠–¢–ê–ü 1 –ó–ê–í–ï–†–®–ï–ù**

–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:
- ‚úÖ POST /api/auth/login –∏ POST /api/auth/register —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å —Å—Ç—Ä–æ–≥–∏–º–∏ –æ—à–∏–±–∫–∞–º–∏
- ‚úÖ –•—ç—à –ø–∞—Ä–æ–ª—è —Å bcrypt
- ‚úÖ httpOnly cookies –¥–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ CSRF –∑–∞—â–∏—Ç–∞
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ credentials –≤ fetch

**–ì–æ—Ç–æ–≤ –∫ –ø–µ—Ä–µ—Ö–æ–¥—É –∫ –≠—Ç–∞–ø—É 2 ‚Äî RBAC –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã –ø–æ —Ä–æ–ª—è–º!** üéØ

